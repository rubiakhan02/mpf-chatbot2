{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 117, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Dell/Desktop/mpf_chatbot/lib/chatbot-logic.js"],"sourcesContent":["const axios = require('axios');\r\n\r\nconst API_URL = 'https://apis.mypropertyfact.in/projects/search-by-type-city-budget';\r\nconst IMAGE_BASE_URL = 'https://apis.mypropertyfact.in/get/images/properties/';\r\n\r\nconst PROPERTY_TYPE_MAP = {\r\n    'residential': 1,\r\n    'commercial': 2,\r\n    'new launch': 1,\r\n    'new launches': 1\r\n};\r\n\r\nconst CITY_MAP = {\r\n    'agra': 1, 'noida': 2, 'ludhiana': 6, 'mumbai': 14, 'ghaziabad': 15,\r\n    'gurugram': 17, 'bangalore': 18, 'jaipur': 19, 'kochi': 20, 'hyderabad': 21,\r\n    'greater noida': 26, 'noida extension': 27, 'lucknow': 31, 'chandigarh': 33,\r\n    'goa': 41, 'delhi': 30, 'faridabad': 35\r\n};\r\n\r\nconst CITY_ALIASES = {\r\n    'gurgaon': 'gurugram',\r\n    'gururam': 'gurugram',\r\n    'benglore': 'bangalore',\r\n    'banglore': 'bangalore',\r\n    'bengaluru': 'bangalore',\r\n    'bengluru': 'bangalore',\r\n    'new delhi': 'delhi',\r\n    'gr noida': 'greater noida',\r\n    'gzb': 'ghaziabad'\r\n};\r\n\r\nconst ALLOWED_CITIES = Object.keys(CITY_MAP).sort((a, b) => b.length - a.length);\r\n\r\nconst STATES = {\r\n    WELCOME: 'WELCOME',\r\n    TYPE_SELECTED: 'TYPE',\r\n    CITY_SELECTED: 'CITY',\r\n    RESULTS: 'RESULTS'\r\n};\r\n\r\n// Simple in-memory session store\r\nconst sessions = {};\r\n\r\nasync function generateAIResponse(message, sessionId) {\r\n    const msg = message.trim().toLowerCase();\r\n\r\n    if (!sessions[sessionId]) {\r\n        sessions[sessionId] = { step: STATES.WELCOME, data: {} };\r\n    }\r\n    const session = sessions[sessionId];\r\n\r\n    // Global State Reset based on keywords (prioritize re-selection)\r\n    const isType = ['commercial', 'residential', 'new launch'].includes(msg);\r\n    const isCity = CITY_MAP[msg] || (CITY_ALIASES[msg] && CITY_MAP[CITY_ALIASES[msg]]) || ['noida', 'gurugram', 'ghaziabad', 'delhi', 'greater noida', 'faridabad', 'other'].includes(msg);\r\n    const isBudget = msg.includes('cr') || msg.includes('crore');\r\n\r\n    if (isType) {\r\n        session.step = STATES.WELCOME;\r\n    } else if (isCity && session.step !== STATES.WELCOME) {\r\n        session.step = STATES.TYPE_SELECTED;\r\n    } else if (isBudget && session.data.type && session.data.city) {\r\n        session.step = STATES.CITY_SELECTED;\r\n    }\r\n\r\n    if (msg === 'restart' || msg === 'reset' || msg === 'hi' || msg === 'hello') {\r\n        session.step = STATES.WELCOME;\r\n        session.data = {};\r\n        session.flags = null;\r\n        return {\r\n            reply: `Hi ðŸ‘‹\\nWelcome to My Property Fact!\\n\\nReady to find the perfect property? ðŸ¡âœ¨\\n\\nPlease select your property type to get started.`,\r\n            options: ['Commercial', 'Residential', 'New Launch']\r\n        };\r\n    }\r\n\r\n    if ((msg === 'yes, explore more' || msg === 'yes') && !session?.flags?.waitingForConfirmation && session.step !== STATES.RESULTS) {\r\n        session.step = STATES.WELCOME;\r\n        return {\r\n            reply: `Great! Let's find more properties.\\n\\nPlease select your property type to get started.`,\r\n            options: ['Commercial', 'Residential', 'New Launch']\r\n        };\r\n    }\r\n    if ((msg === 'no, thank you' || msg === 'no') && !session?.flags?.waitingForConfirmation && session.step !== STATES.RESULTS) {\r\n        return {\r\n            reply: `It was a pleasure helping you! Have a great day. ðŸ‘‹`,\r\n            options: ['Restart']\r\n        };\r\n    }\r\n\r\n    switch (session.step) {\r\n        case STATES.WELCOME:\r\n            if (msg.includes('commercial') || msg.includes('residential') || msg.includes('new launch')) {\r\n                let typeKey = 'residential';\r\n                if (msg.includes('commercial')) typeKey = 'commercial';\r\n                if (msg.includes('residential')) typeKey = 'residential';\r\n                if (msg.includes('new launch')) typeKey = 'new launch';\r\n\r\n                session.data.type = typeKey;\r\n                session.step = STATES.TYPE_SELECTED;\r\n\r\n                return {\r\n                    reply: `Which city are you interested in?`,\r\n                    options: ['Noida', 'Gurugram', 'Ghaziabad', 'Greater Noida', 'Faridabad', 'Delhi', 'Other']\r\n                };\r\n            } else {\r\n                return {\r\n                    reply: `Hi ðŸ‘‹\\nWelcome to My Property Fact!\\n\\nReady to find the perfect property? ðŸ¡âœ¨\\n\\nPlease select your property type to get started.`,\r\n                    options: ['Commercial', 'Residential', 'New Launch']\r\n                };\r\n            }\r\n\r\n        case STATES.TYPE_SELECTED:\r\n            let inputCity = msg.trim().toLowerCase();\r\n            if (CITY_ALIASES[inputCity]) {\r\n                inputCity = CITY_ALIASES[inputCity];\r\n            }\r\n\r\n            if (inputCity === 'other') {\r\n                session.flags = { waitingForCity: true };\r\n                return {\r\n                    reply: `Please enter your preferred city:`,\r\n                    options: []\r\n                };\r\n            }\r\n\r\n            const getLevenshteinDistance = (a, b) => {\r\n                if (a.length === 0) return b.length;\r\n                if (b.length === 0) return a.length;\r\n                const matrix = [];\r\n                for (let i = 0; i <= b.length; i++) matrix[i] = [i];\r\n                for (let j = 0; j <= a.length; j++) matrix[0][j] = j;\r\n                for (let i = 1; i <= b.length; i++) {\r\n                    for (let j = 1; j <= a.length; j++) {\r\n                        if (b.charAt(i - 1) == a.charAt(j - 1)) {\r\n                            matrix[i][j] = matrix[i - 1][j - 1];\r\n                        } else {\r\n                            matrix[i][j] = Math.min(matrix[i - 1][j - 1] + 1, matrix[i][j - 1] + 1, matrix[i - 1][j] + 1);\r\n                        }\r\n                    }\r\n                }\r\n                return matrix[b.length][a.length];\r\n            };\r\n\r\n            if (msg === 'buy property') {\r\n                session.flags = null;\r\n                session.step = STATES.WELCOME;\r\n                return {\r\n                    reply: `Please select your property type to get started.`,\r\n                    options: ['Commercial', 'Residential', 'New Launch']\r\n                };\r\n            }\r\n\r\n            if (session.flags && session.flags.waitingForConfirmation) {\r\n                if (msg === 'yes' || msg === 'yes, correct') {\r\n                    session.data.city = session.flags.suggestedCity;\r\n                    session.step = STATES.CITY_SELECTED;\r\n                    session.flags = null;\r\n                    return {\r\n                        reply: `What is your budget range?`,\r\n                        options: ['Up to â‚¹1 Cr', 'â‚¹1 Cr â€“ â‚¹3 Cr', 'â‚¹3 Cr â€“ â‚¹5 Cr', 'Above â‚¹5 Cr']\r\n                    };\r\n                } else {\r\n                    session.flags = null;\r\n                    return {\r\n                        reply: `Currently, we donâ€™t have any projects in this location.\\n\\nWould you like to see projects in another city? \\n\\nPlease select a city:`,\r\n                        options: ['Noida', 'Gurugram', 'Ghaziabad', 'Greater Noida', 'Faridabad', 'Delhi', 'Other']\r\n                    };\r\n                }\r\n            }\r\n\r\n            if (session.flags && session.flags.waitingForCity) {\r\n                const matched = ALLOWED_CITIES.find(c => {\r\n                    const regex = new RegExp(`\\\\b${c}\\\\b`, 'i');\r\n                    return regex.test(inputCity);\r\n                });\r\n                let fuzzyMatch = null;\r\n                if (!matched) {\r\n                    for (const city of ALLOWED_CITIES) {\r\n                        const dist = getLevenshteinDistance(inputCity, city);\r\n                        const threshold = city.length > 5 ? 3 : 2;\r\n                        if (dist <= threshold) {\r\n                            fuzzyMatch = city;\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n\r\n                const isQuestion = /^(who|what|where|when|why|how|can|do|does|is|are)\\b/.test(inputCity);\r\n                const hasKeywords = /(joke|weather|movie|song|story|poem|president|minister|color|hair|time|date|news|cricket|score)/.test(inputCity);\r\n                const longSentence = inputCity.split(/\\s+/).length > 3;\r\n                const isOutOfScope = isQuestion || hasKeywords || longSentence;\r\n\r\n                if (matched) {\r\n                    session.data.city = matched;\r\n                    session.step = STATES.CITY_SELECTED;\r\n                    session.flags = null;\r\n                    return {\r\n                        reply: `What is your budget range?`,\r\n                        options: ['Up to â‚¹1 Cr', 'â‚¹1 Cr â€“ â‚¹3 Cr', 'â‚¹3 Cr â€“ â‚¹5 Cr', 'Above â‚¹5 Cr']\r\n                    };\r\n                } else if (fuzzyMatch) {\r\n                    session.flags.waitingForConfirmation = true;\r\n                    session.flags.suggestedCity = fuzzyMatch;\r\n                    session.flags.waitingForCity = false;\r\n                    const displayCity = fuzzyMatch.charAt(0).toUpperCase() + fuzzyMatch.slice(1);\r\n                    return {\r\n                        reply: `Did you mean *${displayCity}*?`,\r\n                        options: ['Yes', 'No']\r\n                    };\r\n                } else if (isOutOfScope) {\r\n                    session.flags = null;\r\n                    return {\r\n                        reply: `That's a great question, but I am here only for property-related queries.\\nWould you like to buy property?`,\r\n                        options: ['Buy Property']\r\n                    };\r\n                } else {\r\n                    session.flags = null;\r\n                    return {\r\n                        reply: `Currently, we donâ€™t have any projects in this location.\\n\\nWould you like to see projects in another city? \\n\\nPlease select a city:`,\r\n                        options: ['Noida', 'Greater Noida', 'Ghaziabad', 'Gurugram', 'Faridabad', 'Delhi', 'Other']\r\n                    };\r\n                }\r\n            }\r\n\r\n            let matchedCity = ALLOWED_CITIES.find(c => {\r\n                const regex = new RegExp(`\\\\b${c}\\\\b`, 'i');\r\n                return regex.test(inputCity);\r\n            });\r\n            if (matchedCity) {\r\n                session.data.city = matchedCity;\r\n                session.step = STATES.CITY_SELECTED;\r\n                return {\r\n                    reply: `What is your budget range?`,\r\n                    options: ['Up to â‚¹1 Cr', 'â‚¹1 Cr â€“ â‚¹3 Cr', 'â‚¹3 Cr â€“ â‚¹5 Cr', 'Above â‚¹5 Cr']\r\n                };\r\n            }\r\n\r\n            const isOutOfScopeDefault = /(joke|weather|movie|song|who are you)/.test(inputCity);\r\n            if (!isOutOfScopeDefault) {\r\n                return {\r\n                    reply: `Currently, we donâ€™t have any projects in this location.\\n\\nWould you like to see projects in another city? \\n\\nPlease select a city:`,\r\n                    options: ['Noida', 'Greater Noida', 'Ghaziabad', 'Gurugram', 'Faridabad', 'Delhi', 'Other']\r\n                };\r\n            }\r\n\r\n            return {\r\n                reply: `That's a great question, but I am here only for property-related queries.\\nI can help you buy property.`,\r\n                options: []\r\n            };\r\n\r\n        case STATES.CITY_SELECTED:\r\n            const BUDGET_MAP = {\r\n                'up to â‚¹1 cr': 'Up to 1Cr',\r\n                'â‚¹1 cr â€“ â‚¹3 cr': '1Cr-3Cr',\r\n                'â‚¹3 cr â€“ â‚¹5 cr': '3Cr-5Cr',\r\n                'above â‚¹5 cr': 'Above 5Cr',\r\n                'up to 1 cr': 'Up to 1Cr',\r\n                'upto 1 cr': 'Up to 1Cr',\r\n                '1 cr - 3 cr': '1Cr-3Cr',\r\n                '1cr - 3cr': '1Cr-3Cr',\r\n                '3 cr - 5 cr': '3Cr-5Cr',\r\n                '3cr - 5cr': '3Cr-5Cr',\r\n                'above 5 cr': 'Above 5Cr',\r\n                'above 5cr': 'Above 5Cr'\r\n            };\r\n\r\n            const cleanMsg = msg.replace(/\\s+/g, ' ').trim();\r\n            if (!BUDGET_MAP[cleanMsg]) {\r\n                return {\r\n                    reply: `Please select a budget range from the options above.`,\r\n                    options: ['Up to â‚¹1 Cr', 'â‚¹1 Cr â€“ â‚¹3 Cr', 'â‚¹3 Cr â€“ â‚¹5 Cr', 'Above â‚¹5 Cr']\r\n                };\r\n            }\r\n\r\n            const apiBudget = BUDGET_MAP[cleanMsg];\r\n            session.data.budget = apiBudget;\r\n            session.step = STATES.RESULTS;\r\n\r\n            try {\r\n                const typeId = PROPERTY_TYPE_MAP[session.data.type] || 1;\r\n                const cityId = CITY_MAP[session.data.city];\r\n\r\n                if (!cityId) {\r\n                    return {\r\n                        reply: `Currently, we donâ€™t have any projects in ${session.data.city || 'this location'}.`,\r\n                        options: ['Restart']\r\n                    };\r\n                }\r\n\r\n                const response = await axios.get(API_URL, {\r\n                    params: {\r\n                        propertyType: typeId,\r\n                        propertyLocation: cityId,\r\n                        budget: apiBudget\r\n                    }\r\n                });\r\n\r\n                session.data.allProjects = response.data || [];\r\n                session.data.currentIndex = 0;\r\n\r\n                const getNextBatch = () => {\r\n                    const batch = session.data.allProjects.slice(session.data.currentIndex, session.data.currentIndex + 3);\r\n                    session.data.currentIndex += 3;\r\n                    return batch;\r\n                };\r\n\r\n                const projects = getNextBatch();\r\n\r\n                if (projects && projects.length > 0) {\r\n                    const cards = projects.map(p => {\r\n                        const slug = p.projectSlug || p.projectName.toLowerCase()\r\n                            .replace(/&/g, 'and')\r\n                            .replace(/[^a-z0-9]+/g, '-')\r\n                            .replace(/(^-|-$)/g, '');\r\n\r\n                        const fullImageUrl = (p.projectThumbnailImage && p.projectThumbnailImage.startsWith('http'))\r\n                            ? p.projectThumbnailImage\r\n                            : (p.projectThumbnailImage ? `${IMAGE_BASE_URL}${slug}/${p.projectThumbnailImage}` : 'https://via.placeholder.com/300x200?text=No+Image');\r\n\r\n                        return {\r\n                            id: p.id,\r\n                            name: p.projectName,\r\n                            location: p.projectAddress || p.cityName,\r\n                            price: p.projectStartingPrice || 'Price on Request',\r\n                            image: fullImageUrl,\r\n                            builder: p.builderName,\r\n                            status: p.projectStatusName,\r\n                            link: `https://mypropertyfact.in/${slug}`\r\n                        };\r\n                    });\r\n\r\n                    const hasMore = session.data.currentIndex < session.data.allProjects.length;\r\n                    const options = hasMore ? ['Yes', 'No'] : ['Restart'];\r\n                    let reply = `Here are the top 3 projects in ${session.data.city}:`;\r\n                    let followUp = null;\r\n\r\n                    if (session.data.currentIndex > 3) reply = `Here are more projects:`;\r\n                    if (hasMore) followUp = `Would you like to see more projects?`;\r\n\r\n                    return {\r\n                        reply: reply,\r\n                        followUp: followUp,\r\n                        projectCards: cards,\r\n                        options: options\r\n                    };\r\n                } else {\r\n                    return {\r\n                        reply: `Sorry, we couldn't find any projects matching your requirement.\\nWould you like to change filters?`,\r\n                        options: ['Restart']\r\n                    };\r\n                }\r\n            } catch (e) {\r\n                console.error(e);\r\n                return {\r\n                    reply: `Something went wrong. Please try again.`,\r\n                    options: ['Restart']\r\n                };\r\n            }\r\n\r\n        case STATES.RESULTS:\r\n            if (['yes', 'yes, please', 'sure'].includes(msg)) {\r\n                const typeId = PROPERTY_TYPE_MAP[session.data.type] || 1;\r\n                const cityId = CITY_MAP[session.data.city];\r\n                const apiBudget = session.data.budget;\r\n                const redirectParam = `propertyType=${typeId}&cityId=${cityId || ''}&budget=${encodeURIComponent(apiBudget)}`;\r\n                const targetUrl = `https://mypropertyfact.in/`;\r\n\r\n                return {\r\n                    reply: `Redirecting you to view more projects on our website...`,\r\n                    redirectUrl: targetUrl\r\n                };\r\n            }\r\n\r\n            if (['no', 'no, thanks'].includes(msg)) {\r\n                return {\r\n                    reply: `Thank you for your time!\\nHave a great day ðŸ˜Š`,\r\n                    options: []\r\n                };\r\n            }\r\n\r\n            return {\r\n                reply: `To search again, please type 'Restart'.`,\r\n                options: ['Restart']\r\n            };\r\n\r\n        default:\r\n            return {\r\n                reply: `Please type 'Restart' to start over.`,\r\n                options: ['Restart']\r\n            };\r\n    }\r\n}\r\n\r\nmodule.exports = {\r\n    generateAIResponse,\r\n    sessions,\r\n    PROPERTY_TYPE_MAP,\r\n    CITY_MAP,\r\n    STATES\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 596, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Dell/Desktop/mpf_chatbot/app/api/chat/route.js"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nconst { generateAIResponse } = require('../../../lib/chatbot-logic');\r\n\r\nexport async function POST(request) {\r\n    try {\r\n        const body = await request.json();\r\n        const { message, sessionId } = body;\r\n\r\n        const responseData = await generateAIResponse(message, sessionId || 'default');\r\n\r\n        return NextResponse.json(responseData);\r\n    } catch (error) {\r\n        console.error('Chat API Error:', error);\r\n        return NextResponse.json({ error: 'Internal Server Error' }, { status: 500 });\r\n    }\r\n}\r\n\r\n// Handle OPTIONS for CORS if needed (Next.js handles basic CORS but explicit might be safer for embedding)\r\nexport async function OPTIONS() {\r\n    return new Response(null, {\r\n        status: 204,\r\n        headers: {\r\n            'Access-Control-Allow-Origin': '*',\r\n            'Access-Control-Allow-Methods': 'GET, POST, OPTIONS',\r\n            'Access-Control-Allow-Headers': 'Content-Type, Authorization, X-Requested-With',\r\n        },\r\n    });\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;AACA,MAAM,EAAE,kBAAkB,EAAE;AAErB,eAAe,KAAK,OAAO;IAC9B,IAAI;QACA,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,OAAO,EAAE,SAAS,EAAE,GAAG;QAE/B,MAAM,eAAe,MAAM,mBAAmB,SAAS,aAAa;QAEpE,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC7B,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,mBAAmB;QACjC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC/E;AACJ;AAGO,eAAe;IAClB,OAAO,IAAI,SAAS,MAAM;QACtB,QAAQ;QACR,SAAS;YACL,+BAA+B;YAC/B,gCAAgC;YAChC,gCAAgC;QACpC;IACJ;AACJ"}}]
}